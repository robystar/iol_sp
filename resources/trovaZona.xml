<plominodatabase id="iol_sp">
  <design>
    <resource id="trovaZona" title="Nuona trova tutte le zone" type="Script (Python)"><![CDATA[## Script (Python) "trovaZona"
##bind container=container
##bind context=context
##bind namespace=
##bind script=script
##bind subpath=traverse_subpath
##parameters=lat,lng
##title=Nuona trova tutte le zone
##
from Products.CMFPlomino.PlominoUtils import json_dumps

result = dict(success=1, cosap=0, allerta2=0, movida=0, zona="")


geom="SRID=4326;POINT(%s %s)" %(lng,lat)

res = context.getParentDatabase().resources.zsql.zsqlCategoriaCosap(geom = geom).dictionaries()
if len(res) == 1:
    result['success'] = 1
    result["cosap"] = res[0]['categoria']
    result["zona"] = res[0]['zona']
    
res = context.getParentDatabase().resources.zsql.zsqlAllerta2(geom = geom).dictionaries()
if len(res) == 1:
    result["allerta2"] = 1

res = context.getParentDatabase().resources.zsql.zsqlMovida(geom = geom).dictionaries()
if len(res) == 1:
    result["movida"] = 1
    
res = context.getParentDatabase().resources.zsql.zsqlKennedy(geom = geom).dictionaries()
if len(res) == 1:
    result["kennedy"] = 1
    
return json_dumps(result)
]]></resource>
  </design>
</plominodatabase>
